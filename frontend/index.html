<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <title>Clientes</title>
    <link rel="stylesheet" href="index.css" />
    <style>
      .button-secondary {
        display: block;
        width: 100%;
        text-align: center;
        padding: 10px;
        border-radius: 10px;
        margin: 10px 0px;
      }
      .button-secondary:hover {
        background-color: rgb(239, 239, 239);
      }
    </style>
  </head>
  <body>
    <main>
      <h1>Contatos</h1>

      <div>
        <input id="nameInput" type="text" placeholder="pesquisar por nome" />
        <input id="cpfInput" type="text" placeholder="pesquisar por CPF" />
        <button id="searchButton" type="button" class="button-primary">
          pesquisar
        </button>
      </div>

      <a class="button-secondary" href="new.html">Novo contato</a>

      <div id="clientList"></div>
    </main>

    <script>
      getClients("http://localhost:8080/clientes");

      document.getElementById("searchButton").addEventListener("click", () => {
        console.log("clicked");
        const nome = document.getElementById("nameInput").value;
        const cpf = document.getElementById("cpfInput").value;

        getClients(
          `http://localhost:8080/clientes?nome=${encodeURIComponent(
            nome
          )}&cpf=${encodeURIComponent(cpf)}`
        );
      });

      function getClients(url) {
        return fetch(url)
          .then((response) => {
            if (!response.ok) {
              throw new Error("Erro ao buscar os dados " + response.status);
            }
            return response.json();
          })
          .then((data) => {
            renderClientes(data);
          });
      }

      function renderClientes(clients) {
        const container = document.getElementById("clientList");
        container.innerHTML = "";
        clients.forEach((client) => {
          const link = document.createElement("a");
          link.href = `show.html?id=${client.id}`;
          const card = document.createElement("div");
          link.appendChild(card);
          card.className = "client-card";
          card.innerHTML = `
            <p> ${client.nome}</p>
            <p class="cpfText"> ${client.cpf}</p>
          `;
          container.appendChild(link);
        });
      }
    </script>
  </body>
</html>
