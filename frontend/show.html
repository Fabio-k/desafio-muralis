<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cliente</title>
    <link rel="stylesheet" href="index.css" />
  </head>
  <body>
    <main>
      <div>
        <a href="index.html">Voltar</a>
        <a id="editLink">Editar</a>
        <button onclick="deleteClient()">excluir</button>
      </div>

      <h1 id="name"></h1>
      <p id="cpf"></p>
      <p id="birthDate"></p>
      <p id="address"></p>
      <ul id="contactList"></ul>
    </main>
  </body>
  <script>
    const params = new URLSearchParams(window.location.search);
    const clientId = params.get("id");
    const editLink = document.getElementById("editLink");
    editLink.href = `edit.html?id=${clientId}`;

    fetch(`http://localhost:8080/clientes/${clientId}`)
      .then((response) => {
        if (!response.ok) {
          throw new Error("Erro ao buscar os dados " + response.status);
        }
        return response.json();
      })
      .then((data) => {
        renderClient(data);
      });

    function renderClient(data) {
      const name = document.getElementById("name");
      const cpf = document.getElementById("cpf");
      const birthDate = document.getElementById("birthDate");
      const address = document.getElementById("address");
      const contactsList = document.getElementById("contactList");

      name.innerText = data.nome;
      cpf.innerText = data.cpf;
      birthDate.innerText = data.data_nascimento;
      address.innerText = data.endereco;

      data.contatos.forEach((contato) => {
        let li = document.createElement("li");
        li.innerText = contato.tipo + " " + contato.valor;
        contactsList.appendChild(li);
      });
    }

    function deleteClient() {
      const confirmDelete = confirm(
        `Tem certeza que deseja excluir esse cliente?`
      );
      if (!confirmDelete) return;

      fetch(`http://localhost:8080/clientes/remove/${clientId}`, {
        method: "DELETE",
      }).then((response) => {
        if (response.status == 204) {
          window.location.href = "index.html";
        }
      });
    }
  </script>
</html>
